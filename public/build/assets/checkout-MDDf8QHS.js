import{r as d,q as O,y as g,j as e,a as q}from"./app-zBeRryV1.js";import{N as M}from"./index-C2__p1WT.js";import{F as Y}from"./index-VFHe-l0t.js";import{I as x}from"./index-Cq9mavGv.js";import{u as B}from"./Store-DvD1EEPr.js";import{B as r,Q as E}from"./react-toastify.esm-C5Cif9zO.js";/* empty css                      */import{I as h}from"./InputError-zI6wgXyw.js";import"./index-CrmwEokY.js";import"./index-BEUZbosG.js";import"./Mobile-Logo-DjYHHJYk.js";import"./CartIcon-Bklb5g16.js";const X=({squareAppId:j,squareLocationId:b})=>{const[P,z]=d.useState(null),[y,N]=d.useState(!1),[t,f]=d.useState({});d.useState(!0);const{guest:p,setGuest:v,cartItems:l,clearCart:F,calculateTotal:u,removeItem:w,updateItemQuantity:R}=B();d.useEffect(()=>{const s=JSON.parse(localStorage.getItem("guestUser"));s&&v(s)},[v]);const o=O().props.auth.user,[n,m]=d.useState({firstName:(o==null?void 0:o.first_name)??"",lastName:(o==null?void 0:o.last_name)??"",email:(o==null?void 0:o.email)??"",phone:"",note:""});d.useEffect(()=>{const s=async()=>{try{if(!l.length){console.log("No items in cart. Redirecting to the menu page..."),r.error("Your cart is empty. Please add items to proceed."),g.visit("/menu");return}if(!p){console.log("guest",p),console.log("You need to log in to proceed. Redirecting to login page..."),r.error("Please log in to proceed with checkout."),window.location.href="/login";return}console.log("Guest details:",p);const i=await(await window.Square.payments(j,b)).card();await i.attach("#card-container"),z(i),console.log("Card component attached successfully.")}catch(a){console.error("Error during payment initialization:",a),r.error("An error occurred while initializing payment. Please try again.")}};G(),s()},[]);const k=(s,a)=>{R(s,a)},D=s=>{w(s)},G=async()=>{const s=a=>({countryCode:"GB",currencyCode:"GBP",total:{amount:a().toString(),label:"Total"}});try{const a=await window.Square.payments(j,b),i=a.paymentRequest(s(u)),c=await a.googlePay(i);await c.attach("#google-pay-button"),document.querySelector("#google-pay-button").addEventListener("click",async()=>{C(()=>c.tokenize(),"Google Pay")})}catch(a){console.error("Error initializing Google Pay:",a),r.error("Failed to initialize Google Pay.")}},C=async(s,a)=>{N(!0);try{const i=await s();if(i.errors){console.error(i.errors),r.error(`${a} payment failed to process.`);return}console.log("token",l),g.post("/process-payment",{nonce:i.token,totalCents:u()*100,products:l,billingDetails:n},{onSuccess:()=>{f({}),r.success("Order is placed successfully!"),F(),g.visit("/")},onError:c=>{var S;console.log(c),f(c),c.billingDetails!=null&&r.error(((S=c.payment)==null?void 0:S.detail)??c.product_detail??"An unexpected error occurred")}})}catch(i){console.error(i),r.error("Payment failed, check for debit and reach out to customer support")}finally{N(!1)}},I=async()=>{C(()=>P.tokenize(),"Card")};return e.jsxs("div",{children:[e.jsx(M,{}),e.jsx("section",{className:"hero-bg d-flex align-items-center ",style:{height:"400px"},children:e.jsx("div",{className:"container  text-center",children:e.jsx(q,{href:"/menu",className:"text-decoration-none",children:e.jsxs("button",{className:"small-btn",children:[e.jsx("span",{className:"material-symbols-outlined ",children:"arrow_back"}),"Back"]})})})}),e.jsx(E,{}),e.jsx("section",{className:"menu-section position-relative",children:e.jsxs("div",{className:"x min-vh-100 p-3",children:[" ",e.jsx("div",{className:"container",children:e.jsx("div",{className:"card mx-auto",children:e.jsxs("div",{className:"container white-bg py-5",children:[e.jsx("section",{className:"",children:e.jsxs("div",{className:"row",children:[e.jsx("h2",{className:"mb-4 text-center",children:"Additional Information"})," ",e.jsx("p",{className:"text-center",children:"Please fill in the boxes below with right information."}),e.jsx("div",{className:"col-md-12 mb-4",children:e.jsx("form",{children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx(x,{type:"text",placeholder:"Enter first name",value:n.firstName,autoComplete:"first Name",name:"firstName",onChangeMethod:s=>m(a=>({...a,firstName:s.target.value}))}),e.jsx(h,{message:t&&(t==null?void 0:t["billingDetails.firstName"]),className:"mt-2",style:{color:"red"}})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx(x,{type:"text",placeholder:"Enter last name",value:n.lastName,onChangeMethod:s=>m({...n,lastName:s.target.value})}),e.jsx(h,{message:t&&(t==null?void 0:t["billingDetails.lastName"]),className:"mt-2",style:{color:"red"}})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx(x,{type:"text",placeholder:"Enter phone number",value:n.phone,onChangeMethod:s=>m({...n,phone:s.target.value})}),e.jsx(h,{message:t&&(t==null?void 0:t["billingDetails.phone"]),className:"mt-2",style:{color:"red"}})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx(x,{type:"email",placeholder:"Enter email address",value:n.email,onChangeMethod:s=>m({...n,email:s.target.value})}),e.jsx(h,{message:t&&(t==null?void 0:t["billingDetails.email"]),className:"mt-2",style:{color:"red"}})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx(x,{type:"text",placeholder:"Enter Address",value:n.note,onChangeMethod:s=>m({...n,note:s.target.value})}),e.jsx(h,{message:t&&(t==null?void 0:t["billingDetails.notes"]),className:"mt-2",style:{color:"red"}})]}),e.jsxs("div",{className:"col-12 col-md-6 bg",children:[e.jsx(x,{type:"text",placeholder:" Order Notes(Optional)",value:n.note,onChangeMethod:s=>m({...n,note:s.target.value})}),e.jsx(h,{message:t&&(t==null?void 0:t["billingDetails.notes"]),className:"mt-2",style:{color:"red"}})]}),e.jsxs("div",{className:"form-check mt-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"extraHotNews"}),e.jsx("label",{className:"form-check-label",htmlFor:"extraHotNews",children:"Want extra hot news? Tick the box"})]})]})})})]})}),e.jsxs("section",{className:"container mt-5 px-4 d-none d-md-block",children:[e.jsx("h3",{className:"text-center fw-bold",children:"Your Order"}),e.jsxs("p",{className:"text-center mb-4",children:["You have ",l.length," item",l.length>1&&"s"," in your order"]}),l.map((s,a)=>e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-3 mb-3 shadow-sm rounded-4",style:{backgroundColor:"#fff"},children:[e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("img",{src:s.image,alt:s.name,style:{width:"70px",height:"70px",objectFit:"cover",borderRadius:"12px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-uppercase",style:{fontSize:"14px"},children:s.name}),e.jsxs("div",{className:"text-muted",style:{fontSize:"13px"},children:["$",s.price.toFixed(2)]})]})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("button",{className:"btn btn-outline-dark btn-sm",onClick:()=>k(s.id,-1),children:"â€“"}),e.jsx("span",{children:s.quantity}),e.jsx("button",{className:"btn btn-outline-dark btn-sm",onClick:()=>k(s.id,1),children:"+"}),e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>D(s.id),children:"ðŸ—‘"})]})]},a))]}),e.jsxs("section",{className:"container my- p-1  d-block d-md-none",children:[e.jsx("h3",{className:"text-center fw-bold",children:"Your Order"}),e.jsxs("p",{className:"text-center mb-4",children:["You have ",l.length," item",l.length>1&&"s"," in your order"]}),l.map((s,a)=>e.jsx("div",{className:"d-flex flex-column flex-md-row align-items-start justify-content-between  mb-3 shadow-sm rounded-4  p-2",style:{backgroundColor:"#fff"},children:e.jsxs("div",{className:"d-flex w-100 gap-3",children:[e.jsx("img",{src:s.image,alt:s.name,style:{width:"70px",height:"70px",objectFit:"cover",borderRadius:"12px",flexShrink:0}}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-bold text-uppercase",style:{fontSize:"14px"},children:s.name}),e.jsxs("div",{className:"text-muted mb-2",style:{fontSize:"13px"},children:["$",s.price.toFixed(2)]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-light",onClick:()=>decreaseQuantity(s.id),children:"â€“"}),e.jsx("div",{className:"bg-dark text-white rounded px-3 py-1",style:{fontWeight:"bold"},children:s.quantity}),e.jsx("button",{className:"btn btn-sm btn-light",onClick:()=>increaseQuantity(s.id),children:"+"}),e.jsx("button",{className:"btn btn-sm text-danger ms-auto",onClick:()=>w(s.id),children:e.jsx("i",{className:"bi bi-trash"})})]})]})]})},a))]}),e.jsxs("div",{className:"p-3 bg-inf",children:[e.jsxs("h3",{className:"text-center fw-bold",children:["Payment Summary"," "]}),e.jsx("p",{className:"text-center mb-4",children:"Enter card details for payment"})]}),e.jsx("div",{className:"py-5 bg-light-grey shadow-sm",children:e.jsxs("div",{className:"col-lg-12 col-12",children:[e.jsxs("div",{className:"card shadow-sm p-4",children:[e.jsx("h5",{className:"fw-bold mb-3",children:"Order Summary"}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Order"}),e.jsxs("span",{children:[l.length,"pcs"]})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["Â£",Number((u()||0)-2).toFixed(2)]})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:"Â£2.00"})]}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold border-top py-2 my-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["Â£",Number(u()||0).toFixed(2)]})]}),e.jsx("div",{id:"card-container"}),e.jsx("button",{onClick:I,disabled:y,className:"btn btn-danger text-white px-3 mx-3 my-5",children:y?"Processing...":"Pay Now"}),e.jsxs("form",{id:"payment-form ",children:[e.jsx("div",{id:"google-pay-button"}),e.jsx("div",{id:"card-container"}),e.jsx("button",{id:"card-button",type:"button",children:u()})]})]}),e.jsx("div",{id:"payment-status-container"})]})})]})})})]})}),e.jsx(Y,{})]})};export{X as default};
