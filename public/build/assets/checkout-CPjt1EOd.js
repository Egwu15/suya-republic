import{r,q as D,j as e,y as u}from"./app-Dx0dZLMF.js";import{N as M,F as U}from"./index-CsUtWBR-.js";import{I as m}from"./index-wcoOIfjr.js";import{u as E}from"./Store-D4AnZtGg.js";import{Q as I,B as o}from"./react-toastify.esm-C9PTYVwm.js";/* empty css                      */import{I as p}from"./InputError-wCx1ouFS.js";import"./Mobile-Logo-DjYHHJYk.js";import"./CartIcon-UqPeCD_X.js";/* empty css              */import"./index-BO72an5p.js";const Q=({squareAppId:x,squareLocationId:y})=>{const[P,w]=r.useState(null),[j,N]=r.useState(!1),[s,g]=r.useState({}),[C,A]=r.useState(!0),{guest:q,setGuest:b,cartItems:i,clearCart:k,calculateTotal:h}=E();r.useEffect(()=>{const a=JSON.parse(localStorage.getItem("guestUser"));a&&b(a)},[b]),D().props.auth.user;const[n,d]=r.useState({firstName:"",lastName:"",email:"",phone:"",note:""});r.useEffect(()=>{(async()=>{if(!i.length){console.log("you don't have item in cart. Redirecting to login page..."),o.error("You need to select item to proceed with checkout."),u.visit("/menu");return}const t=await(await window.Square.payments(x,y)).card();await t.attach("#card-container"),w(t),await applePay.attach("#apple-pay-button"),A(!0)})()},[]);const S=async()=>{try{const a=await window.Square.payments(x,y),l=a.paymentRequest({countryCode:"UK",currencyCode:"GBP",total:{amount:h()*100,label:"Total"}}),t=await a.applePay(l);if(!await t.canMakePayment()){console.log("Apple Pay is not available on this device/browser."),o.error("Apple Pay is not available on your device.");return}await t.attach("#apple-pay-button"),document.querySelector("#apple-pay-button").addEventListener("click",async()=>{v(()=>t.tokenize(),"Apple Pay")})}catch(a){console.error("Error initializing Apple Pay:",a),o.error("Failed to initialize Apple Pay.")}},v=async(a,l)=>{N(!0);try{const t=await a();if(t.errors){console.error(t.errors),o.error(`${l} payment failed to process.`);return}console.log("token",i),u.post("/process-payment",{nonce:t.token,totalCents:h()*100,products:i,billingDetails:n},{onSuccess:()=>{g({}),o.success("Order is placed successfully!"),k(),u.visit("/")},onError:c=>{var f;console.log(c),g(c),c.billingDetails!=null&&o.error(((f=c.payment)==null?void 0:f.detail)??c.product_detail??"An unexpected error occurred")}})}catch(t){console.error(t),o.error("Payment failed, check for debit and reach out to customer support")}finally{N(!1)}},F=async()=>{v(()=>P.tokenize(),"Card")};return e.jsxs("div",{children:[e.jsx(M,{}),e.jsx("section",{className:"our-menu text-center py-5 bg-light",children:e.jsx("div",{className:"container",children:e.jsx("h1",{className:"mb-2",children:"CHECKOUT"})})}),e.jsx(I,{}),e.jsx("section",{className:"container mt-5",children:e.jsxs("div",{className:"alert alert-info text-center",children:["All orders are to be collected in-store at",e.jsx("strong",{children:" 303 Chester Road, Manchester M15 4EY"})]})}),e.jsx("section",{className:"container mt-5",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-4",children:[e.jsx("h2",{className:"mb-4",children:"Billing & Shipping"}),e.jsx("form",{children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"firstName",className:"form-label",children:"First Name *"}),e.jsx(m,{type:"text",placeholder:"Enter first name",value:n.firstName,autoComplete:"first Name",name:"firstName",onChangeMethod:a=>d(l=>({...l,firstName:a.target.value}))}),e.jsx(p,{message:s&&(s==null?void 0:s["billingDetails.firstName"]),className:"mt-2",style:{color:"red"}})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"lastName",className:"form-label",children:"Last Name *"}),e.jsx(m,{type:"text",placeholder:"Enter last name",value:n.lastName,onChangeMethod:a=>d({...n,lastName:a.target.value})}),e.jsx(p,{message:s&&(s==null?void 0:s["billingDetails.lastName"]),className:"mt-2",style:{color:"red"}})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone *"}),e.jsx(m,{type:"text",placeholder:"Enter phone number",value:n.phone,onChangeMethod:a=>d({...n,phone:a.target.value})}),e.jsx(p,{message:s&&(s==null?void 0:s["billingDetails.phone"]),className:"mt-2",style:{color:"red"}})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email Address *"}),e.jsx(m,{type:"email",placeholder:"Enter email address",value:n.email,onChangeMethod:a=>d({...n,email:a.target.value})}),e.jsx(p,{message:s&&(s==null?void 0:s["billingDetails.email"]),className:"mt-2",style:{color:"red"}})]})]})})]}),e.jsxs("div",{className:"col-md-6 mb-4",children:[e.jsx("h2",{className:"mb-4",children:"Additional Information"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"orderNotes",className:"form-label",children:"Order Notes (Optional)"}),e.jsx(m,{type:"text",placeholder:"Notes about your order",value:n.note,onChangeMethod:a=>d({...n,note:a.target.value})}),e.jsx(p,{message:s&&(s==null?void 0:s["billingDetails.notes"]),className:"mt-2",style:{color:"red"}})]})]})]})}),e.jsxs("section",{className:"container mt-5 px-4",children:[e.jsx("h3",{className:"mb-4 text-center",children:"Your Order"}),i.map((a,l)=>e.jsxs("div",{className:"row align-items-center border-bottom py-2",children:[e.jsxs("div",{className:"col-6",children:[a.name," - ",a.description," × ",a.quantity]}),e.jsxs("div",{className:"col-6 text-end",children:["£",a.price," "]})]},l)),e.jsxs("div",{className:"row align-items-center border-bottom py-2",children:[e.jsx("div",{className:"col-6",children:"Subtotal"}),e.jsxs("div",{className:"col-6 text-end",children:["£",i.reduce((a,l)=>a+l.price*l.quantity,0).toFixed(2)]})]}),e.jsxs("div",{className:"row align-items-center py-2",children:[e.jsx("div",{className:"col-6",children:e.jsx("strong",{children:"Total"})}),e.jsx("div",{className:"col-6 text-end",children:e.jsxs("strong",{children:["£",h()]})})]})]}),e.jsxs("div",{className:"p-3 bg-inf",children:[e.jsx("h3",{className:"text-center",children:"Card Payment"}),e.jsx("hr",{})]}),e.jsxs("div",{className:"p-5 bg-light-grey",children:[e.jsx("h2",{children:"Checkout"}),e.jsxs("p",{children:["Total: £",h()]}),e.jsx("div",{id:"card-container"}),e.jsx("button",{onClick:F,disabled:j,className:"btn btn-danger text-white px-3",children:j?"Processing...":"Pay Now"}),e.jsx("div",{id:"apple-pay-button",children:C&&e.jsx("button",{onClick:S,className:"btn btn-primary text-white px-3",children:"Pay with Apple Pay"})})]}),e.jsx(U,{})]})};export{Q as default};
